@using Microsoft.AspNetCore.Components.Web

<div class="w-full max-w-2xl mx-auto p-6">
    <h2 class="text-2xl font-bold text-white mb-6">Recent Activity</h2>
    
    <div class="space-y-2">
        @foreach (var activity in activities)
        {
            <div class="relative"
                 @onmouseenter="() => HandleMouseEnter(activity.Id)"
                 @onmouseleave="HandleMouseLeave">
                
                <!-- List Item -->
                <div class="flex items-center justify-between p-4 bg-gray-800 rounded-lg border border-gray-700 hover:bg-gray-750 hover:border-gray-600 transition-colors cursor-pointer">
                    <div class="flex items-center gap-3 flex-1 min-w-0">
                        <div class="@GetStatusColorClass(activity.Status) w-2 h-2 rounded-full flex-shrink-0"></div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-white truncate">@activity.Title</p>
                            <p class="text-xs text-gray-400">@activity.Timestamp</p>
                        </div>
                    </div>
                    <span class="text-xs px-2 py-1 rounded @GetStatusBadgeClass(activity.Status) flex-shrink-0">
                        @activity.Status
                    </span>
                </div>

                <!-- Hover Card -->
                @if (hoveredActivityId == activity.Id)
                {
                    <div class="absolute left-0 right-0 top-full mt-2 z-50 animate-in fade-in duration-150">
                        <div class="bg-gray-800 rounded-lg border border-gray-600 shadow-2xl p-4 w-full">
                            <!-- Header -->
                            <div class="flex items-start justify-between mb-3">
                                <div class="flex-1">
                                    <h3 class="text-sm font-semibold text-white mb-1">@activity.Title</h3>
                                    <p class="text-xs text-gray-400">@activity.Timestamp</p>
                                </div>
                                <span class="text-xs px-2 py-1 rounded @GetStatusBadgeClass(activity.Status)">
                                    @activity.Status
                                </span>
                            </div>

                            <!-- Full Details -->
                            <div class="space-y-3 mb-4">
                                <div>
                                    <p class="text-xs text-gray-500 mb-1">Full Log Details</p>
                                    <p class="text-sm text-gray-300">@activity.FullDetails</p>
                                </div>

                                <div>
                                    <p class="text-xs text-gray-500 mb-1">Error Code</p>
                                    <code class="text-sm text-red-400 bg-gray-900 px-2 py-1 rounded">@activity.ErrorCode</code>
                                </div>

                                @if (!string.IsNullOrEmpty(activity.AdditionalInfo))
                                {
                                    <div>
                                        <p class="text-xs text-gray-500 mb-1">Additional Information</p>
                                        <p class="text-xs text-gray-400">@activity.AdditionalInfo</p>
                                    </div>
                                }
                            </div>

                            <!-- Action Button -->
                            <button @onclick="() => HandleFixIssue(activity.Id)"
                                    class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-md transition-colors">
                                Fix Issue
                            </button>
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</div>

@code {
    private string? hoveredActivityId = null;
    private List<ActivityItem> activities = new();

    protected override void OnInitialized()
    {
        activities = new List<ActivityItem>
        {
            new ActivityItem
            {
                Id = "1",
                Title = "Database connection timeout",
                Status = "error",
                Timestamp = "2 minutes ago",
                FullDetails = "Failed to establish connection to PostgreSQL database after 30 seconds. Connection string may be incorrect or database server is unreachable.",
                ErrorCode = "ERR_DB_TIMEOUT_001",
                AdditionalInfo = "Retry attempts: 3 | Last attempt: 2024-01-15 14:32:45 UTC"
            },
            new ActivityItem
            {
                Id = "2",
                Title = "API rate limit exceeded",
                Status = "warning",
                Timestamp = "5 minutes ago",
                FullDetails = "External API rate limit of 1000 requests per hour has been exceeded. Service temporarily throttled.",
                ErrorCode = "WARN_API_RATE_429",
                AdditionalInfo = "Current usage: 1,247 requests | Reset in: 42 minutes"
            },
            new ActivityItem
            {
                Id = "3",
                Title = "User authentication successful",
                Status = "success",
                Timestamp = "8 minutes ago",
                FullDetails = "User 'john.doe@example.com' successfully authenticated using OAuth 2.0 provider.",
                ErrorCode = "INFO_AUTH_200",
                AdditionalInfo = "IP: 192.168.1.105 | Location: San Francisco, CA"
            },
            new ActivityItem
            {
                Id = "4",
                Title = "Cache invalidation in progress",
                Status = "info",
                Timestamp = "12 minutes ago",
                FullDetails = "Redis cache being cleared for user profile updates. Estimated completion time: 2-3 minutes.",
                ErrorCode = "INFO_CACHE_PURGE",
                AdditionalInfo = "Affected keys: 1,432 | Cache cluster: us-west-2"
            },
            new ActivityItem
            {
                Id = "5",
                Title = "Disk space critically low",
                Status = "error",
                Timestamp = "15 minutes ago",
                FullDetails = "Server disk usage has reached 95% capacity. Immediate action required to prevent service disruption.",
                ErrorCode = "ERR_DISK_CRITICAL_003",
                AdditionalInfo = "Available space: 2.3 GB | Total capacity: 500 GB"
            }
        };
    }

    private void HandleMouseEnter(string activityId)
    {
        hoveredActivityId = activityId;
    }

    private void HandleMouseLeave()
    {
        hoveredActivityId = null;
    }

    private void HandleFixIssue(string activityId)
    {
        var activity = activities.FirstOrDefault(a => a.Id == activityId);
        if (activity != null)
        {
            Console.WriteLine($"[v0] Fixing issue for activity: {activity.Title}");
            // Add your fix issue logic here
        }
    }

    private string GetStatusColorClass(string status)
    {
        return status switch
        {
            "error" => "bg-red-500",
            "warning" => "bg-yellow-500",
            "success" => "bg-green-500",
            "info" => "bg-blue-500",
            _ => "bg-gray-500"
        };
    }

    private string GetStatusBadgeClass(string status)
    {
        return status switch
        {
            "error" => "bg-red-500/10 text-red-400 border border-red-500/20",
            "warning" => "bg-yellow-500/10 text-yellow-400 border border-yellow-500/20",
            "success" => "bg-green-500/10 text-green-400 border border-green-500/20",
            "info" => "bg-blue-500/10 text-blue-400 border border-blue-500/20",
            _ => "bg-gray-500/10 text-gray-400 border border-gray-500/20"
        };
    }

    public class ActivityItem
    {
        public string Id { get; set; } = string.Empty;
        public string Title { get; set; } = string.Empty;
        public string Status { get; set; } = string.Empty;
        public string Timestamp { get; set; } = string.Empty;
        public string FullDetails { get; set; } = string.Empty;
        public string ErrorCode { get; set; } = string.Empty;
        public string AdditionalInfo { get; set; } = string.Empty;
    }
}
