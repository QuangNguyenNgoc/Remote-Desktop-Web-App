@page "/devices/{Id}"
@inject NavigationManager Nav
@inject IJSRuntime JS

@code {
    [Parameter]
    public string Id { get; set; } = default!;

    private bool _checked;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender || _checked) return;
        _checked = true;

        var authed = await JS.InvokeAsync<bool>("passkeyAuth.me");
        if (!authed)
        {
            var returnUrl = new Uri(Nav.Uri).PathAndQuery;
            Nav.NavigateTo($"/login?returnUrl={Uri.EscapeDataString(returnUrl)}", forceLoad: true);
            return;
        }
    }

    void GoBack()
    {
        Nav.NavigateTo("/devices");
    }
}

<!-- Info Bar & Actions -->
<DeviceHeader DeviceId="@Id" />

<!-- Tabs & Remote Screen - Pass AgentId via CascadingValue -->
<CascadingValue Value="@Id" Name="AgentId">
    <RemoteScreen />
</CascadingValue>

<!-- Terminal Log -->
<TerminalLog DeviceId="@Id" />
